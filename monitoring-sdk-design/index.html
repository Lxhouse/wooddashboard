<!DOCTYPE html><html lang="en" class="__className_693a70"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/wooddashboard/_next/static/media/4f05ba3a6752a328-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/wooddashboard/_next/static/media/710e6adf42e8fe6f-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/wooddashboard/_next/static/media/7b379c56c483b024-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/wooddashboard/_next/static/media/7b9ca6a1d31c5662-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/wooddashboard/_next/static/media/931105f8d96e7f26-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/wooddashboard/_next/static/css/f4c9dd7a6d7a870e.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/wooddashboard/_next/static/chunks/webpack-488dd228726fd375.js"/><script src="/wooddashboard/_next/static/chunks/c7bb1776-c2f4efdb2dd536b7.js" async=""></script><script src="/wooddashboard/_next/static/chunks/733-67c0529a92e07332.js" async=""></script><script src="/wooddashboard/_next/static/chunks/main-app-c034ed0aa1bc7094.js" async=""></script><script src="/wooddashboard/_next/static/chunks/645-cf0c536310c9bd45.js" async=""></script><script src="/wooddashboard/_next/static/chunks/app/%5Bslug%5D/layout-447ff52c5afa5bc6.js" async=""></script><script src="/wooddashboard/_next/static/chunks/792-a990f77874873bec.js" async=""></script><script src="/wooddashboard/_next/static/chunks/app/layout-1a2c4bccb07c8fb1.js" async=""></script><script src="/wooddashboard/_next/static/chunks/app/%5Bslug%5D/page-0b8af52342fb8394.js" async=""></script><title>我是如何设计前端监控 SDK 的 — wooddashboard</title><meta name="description" content="分享我在设计前端监控 SDK 时的架构思考，包括插件系统、生命周期管理、数据存储等核心设计"/><link rel="icon" href="/wooddashboard/icon.png?7c5860f098ab6c65" type="image/png" sizes="400x400"/><meta name="next-size-adjust"/><script src="/wooddashboard/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="mx-auto max-w-2xl bg-[--bg] px-5 py-12 text-[--text]"><header class="mb-14 flex flex-row place-content-between"><a class="__className_620977 inline-block text-2xl font-black hover:scale-[1.02] scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="/wooddashboard/"><span style="--myColor1:var(--pink);--myColor2:var(--purple);background-image:linear-gradient(45deg, var(--myColor1), var(--myColor2));background-clip:text;-webkit-background-clip:text;color:transparent;transition:--myColor1 0.2s ease-out, --myColor2 0.2s ease-in-out">wooddashboard</span></a><span class="relative top-[4px] italic ">by<!-- --> <a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="https://github.com/Lxhouse"><img alt="Zhe Mu" loading="lazy" width="32" height="32" decoding="async" data-nimg="1" class="relative -top-1 mx-1 inline h-8 w-8 rounded-full hover:scale-[1.05]" style="color:transparent" srcSet="https://avatars.githubusercontent.com/u/82502913 1x, https://avatars.githubusercontent.com/u/82502913 2x" src="https://avatars.githubusercontent.com/u/82502913"/></a></span></header><main><div class="mx-auto max-w-[90rem] px-4 sm:px-6 lg:px-8"><div class="relative lg:flex lg:gap-8"><article class="prose prose-lg dark:prose-invert lg:min-w-[720px] lg:max-w-[720px] xl:min-w-[800px] xl:max-w-[800px]"><h1 class="__className_620977 text-[40px] font-black leading-[44px] text-[--title] mb-4">我是如何设计前端监控 SDK 的</h1><p class="text-sm text-gray-700 dark:text-gray-300 mb-8">2024/10/11</p><div class="markdown"><h1 id="-sdk-"><a href="#-sdk-" class="anchor">我是如何设计前端监控 SDK 的</a></h1>
<p>作为一名前端监控领域的开发者，我一直在思考如何设计一个既灵活又高效的监控 SDK。经过多次迭代和实践，我最终确定了一个以插件系统和生命周期为核心的架构设计。让我来分享一下这个设计的核心思路。</p>
<h2 id="-"><a href="#-" class="anchor">核心架构设计</a></h2>
<h3 id="1-thelogger-"><a href="#1-thelogger-" class="anchor">1. TheLogger 核心类</a></h3>
<p>在设计之初，我就决定要有一个强大的核心类作为整个 SDK 的基础。我将其命名为 TheLogger，它负责协调整个监控系统的运行。</p>
<div data-rehype-pretty-code-fragment=""><pre class="Overnight" style="background-color:var(--code-bg)" tabindex="0" data-language="ts" data-theme="default"><code data-language="ts" data-theme="default" style="display:grid"><span data-line=""><span style="color:#FFA7C4">class</span><span style="color:#CED2D6"> </span><span style="color:#FFCB8B">TheLogger</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">private</span><span style="color:#CED2D6"> plugins</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#FFCB8B">Plugin</span><span style="color:#C792EA">[]</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">=</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">[];</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">private</span><span style="color:#CED2D6"> lifecycle</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#FFCB8B">Lifecycle</span><span style="color:#C792EA">;</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">private</span><span style="color:#CED2D6"> store</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#FFCB8B">Store</span><span style="color:#C792EA">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#8EACE3">constructor</span><span style="color:#C792EA">(</span><span style="color:#CED2D6">config</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#FFCB8B">LoggerConfig</span><span style="color:#C792EA">)</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">lifecycle </span><span style="color:#C792EA">=</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">new</span><span style="color:#CED2D6"> </span><span style="color:#8EACE3">Lifecycle</span><span style="color:#C792EA">();</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">store </span><span style="color:#C792EA">=</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">new</span><span style="color:#CED2D6"> </span><span style="color:#8EACE3">Store</span><span style="color:#C792EA">(</span><span style="color:#CED2D6">config</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">storage</span><span style="color:#C792EA">);</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#637777">// 生命周期方法</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">async</span><span style="color:#CED2D6"> </span><span style="color:#8EACE3">init</span><span style="color:#C792EA">()</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#FFA7C4">await</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">lifecycle</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">emit</span><span style="color:#C792EA">(</span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">init</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">);</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#FFA7C4">await</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">initPlugins</span><span style="color:#C792EA">();</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">async</span><span style="color:#CED2D6"> </span><span style="color:#8EACE3">start</span><span style="color:#C792EA">()</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#FFA7C4">await</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">lifecycle</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">emit</span><span style="color:#C792EA">(</span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">start</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">);</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#FFA7C4">await</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">startPlugins</span><span style="color:#C792EA">();</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">async</span><span style="color:#CED2D6"> </span><span style="color:#8EACE3">stop</span><span style="color:#C792EA">()</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#FFA7C4">await</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">lifecycle</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">emit</span><span style="color:#C792EA">(</span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">stop</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">);</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#FFA7C4">await</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">stopPlugins</span><span style="color:#C792EA">();</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">async</span><span style="color:#CED2D6"> </span><span style="color:#8EACE3">destroy</span><span style="color:#C792EA">()</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#FFA7C4">await</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">lifecycle</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">emit</span><span style="color:#C792EA">(</span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">destroy</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">);</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#FFA7C4">await</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">destroyPlugins</span><span style="color:#C792EA">();</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">}</span></span>
<span data-line=""><span style="color:#C792EA">}</span></span></code></pre></div>
<h3 id="2-"><a href="#2-" class="anchor">2. 插件系统</a></h3>
<p>插件系统是我最自豪的设计之一。它让 SDK 具备了无限的扩展可能：</p>
<div data-rehype-pretty-code-fragment=""><pre class="Overnight" style="background-color:var(--code-bg)" tabindex="0" data-language="ts" data-theme="default"><code data-language="ts" data-theme="default" style="display:grid"><span data-line=""><span style="color:#FFA7C4">interface</span><span style="color:#CED2D6"> Plugin </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">  name</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#8EACE3">string</span><span style="color:#C792EA">;</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#8EACE3">apply</span><span style="color:#C792EA">(</span><span style="color:#CED2D6">logger</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#FFCB8B">TheLogger</span><span style="color:#C792EA">):</span><span style="color:#CED2D6"> </span><span style="color:#8EACE3">void</span><span style="color:#C792EA">;</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#8EACE3">init</span><span style="color:#C792EA">?():</span><span style="color:#CED2D6"> </span><span style="color:#FFCB8B">Promise</span><span style="color:#CED2D6">&lt;</span><span style="color:#8EACE3">void</span><span style="color:#CED2D6">&gt;</span><span style="color:#C792EA">;</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#8EACE3">start</span><span style="color:#C792EA">?():</span><span style="color:#CED2D6"> </span><span style="color:#FFCB8B">Promise</span><span style="color:#CED2D6">&lt;</span><span style="color:#8EACE3">void</span><span style="color:#CED2D6">&gt;</span><span style="color:#C792EA">;</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#8EACE3">stop</span><span style="color:#C792EA">?():</span><span style="color:#CED2D6"> </span><span style="color:#FFCB8B">Promise</span><span style="color:#CED2D6">&lt;</span><span style="color:#8EACE3">void</span><span style="color:#CED2D6">&gt;</span><span style="color:#C792EA">;</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#8EACE3">destroy</span><span style="color:#C792EA">?():</span><span style="color:#CED2D6"> </span><span style="color:#FFCB8B">Promise</span><span style="color:#CED2D6">&lt;</span><span style="color:#8EACE3">void</span><span style="color:#CED2D6">&gt;</span><span style="color:#C792EA">;</span></span>
<span data-line=""><span style="color:#C792EA">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#FFA7C4">class</span><span style="color:#CED2D6"> </span><span style="color:#FFCB8B">ClickTrackingPlugin</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">implements</span><span style="color:#CED2D6"> Plugin </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">  name </span><span style="color:#C792EA">=</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">click-tracking</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">;</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">private</span><span style="color:#CED2D6"> </span><span style="color:#8EACE3">handler</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">(</span><span style="color:#CED2D6">e</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#FFCB8B">MouseEvent</span><span style="color:#C792EA">)</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">=&gt;</span><span style="color:#CED2D6"> </span><span style="color:#8EACE3">void</span><span style="color:#C792EA">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#8EACE3">apply</span><span style="color:#C792EA">(</span><span style="color:#CED2D6">logger</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#FFCB8B">TheLogger</span><span style="color:#C792EA">)</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">handler</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">=</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">(</span><span style="color:#CED2D6">e</span><span style="color:#C792EA">)</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">=&gt;</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">      logger</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">track</span><span style="color:#C792EA">(</span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">click</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">,</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">        x</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> e</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">clientX</span><span style="color:#C792EA">,</span></span>
<span data-line=""><span style="color:#CED2D6">        y</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> e</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">clientY</span><span style="color:#C792EA">,</span></span>
<span data-line=""><span style="color:#CED2D6">        target</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> e</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">target</span><span style="color:#C792EA">,</span></span>
<span data-line=""><span style="color:#CED2D6">      </span><span style="color:#C792EA">});</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#C792EA">};</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#8EACE3">start</span><span style="color:#C792EA">()</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">    document</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">addEventListener</span><span style="color:#C792EA">(</span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">click</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">,</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">handler</span><span style="color:#C792EA">);</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#8EACE3">stop</span><span style="color:#C792EA">()</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">    document</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">removeEventListener</span><span style="color:#C792EA">(</span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">click</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">,</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">handler</span><span style="color:#C792EA">);</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">}</span></span>
<span data-line=""><span style="color:#C792EA">}</span></span></code></pre></div>
<h3 id="3-"><a href="#3-" class="anchor">3. 服务层设计</a></h3>
<p>我特意将服务层设计成可扩展的形式：</p>
<div data-rehype-pretty-code-fragment=""><pre class="Overnight" style="background-color:var(--code-bg)" tabindex="0" data-language="ts" data-theme="default"><code data-language="ts" data-theme="default" style="display:grid"><span data-line=""><span style="color:#FFA7C4">interface</span><span style="color:#CED2D6"> LoggerService </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#8EACE3">serve</span><span style="color:#C792EA">():</span><span style="color:#CED2D6"> </span><span style="color:#FFCB8B">Promise</span><span style="color:#CED2D6">&lt;</span><span style="color:#8EACE3">void</span><span style="color:#CED2D6">&gt;</span><span style="color:#C792EA">;</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#8EACE3">send</span><span style="color:#C792EA">(</span><span style="color:#CED2D6">data</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#FFCB8B">LogData</span><span style="color:#C792EA">):</span><span style="color:#CED2D6"> </span><span style="color:#FFCB8B">Promise</span><span style="color:#CED2D6">&lt;</span><span style="color:#8EACE3">void</span><span style="color:#CED2D6">&gt;</span><span style="color:#C792EA">;</span></span>
<span data-line=""><span style="color:#C792EA">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#FFA7C4">class</span><span style="color:#CED2D6"> </span><span style="color:#FFCB8B">DefaultService</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">implements</span><span style="color:#CED2D6"> LoggerService </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">private</span><span style="color:#CED2D6"> worker</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#FFCB8B">Worker</span><span style="color:#C792EA">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#8EACE3">constructor</span><span style="color:#C792EA">()</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">worker </span><span style="color:#C792EA">=</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">new</span><span style="color:#CED2D6"> </span><span style="color:#8EACE3">Worker</span><span style="color:#C792EA">(</span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">logger-worker.js</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">);</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">async</span><span style="color:#CED2D6"> </span><span style="color:#8EACE3">serve</span><span style="color:#C792EA">()</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#637777">// 初始化服务</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#FFA7C4">await</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">initWorker</span><span style="color:#C792EA">();</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#FFA7C4">await</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">initStorage</span><span style="color:#C792EA">();</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">async</span><span style="color:#CED2D6"> </span><span style="color:#8EACE3">send</span><span style="color:#C792EA">(</span><span style="color:#CED2D6">data</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#FFCB8B">LogData</span><span style="color:#C792EA">)</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#637777">// 通过 Worker 异步处理数据</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">worker</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">postMessage</span><span style="color:#C792EA">({</span></span>
<span data-line=""><span style="color:#CED2D6">      type</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">process</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">,</span></span>
<span data-line=""><span style="color:#CED2D6">      data</span><span style="color:#C792EA">,</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#C792EA">});</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">}</span></span>
<span data-line=""><span style="color:#C792EA">}</span></span></code></pre></div>
<h3 id="4-"><a href="#4-" class="anchor">4. 数据存储策略</a></h3>
<p>在存储方面，我选择了 IndexedDB 作为主要存储方案：</p>
<div data-rehype-pretty-code-fragment=""><pre class="Overnight" style="background-color:var(--code-bg)" tabindex="0" data-language="ts" data-theme="default"><code data-language="ts" data-theme="default" style="display:grid"><span data-line=""><span style="color:#FFA7C4">class</span><span style="color:#CED2D6"> </span><span style="color:#FFCB8B">Store</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">private</span><span style="color:#CED2D6"> db</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#FFCB8B">IDBDatabase</span><span style="color:#C792EA">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">async</span><span style="color:#CED2D6"> </span><span style="color:#8EACE3">init</span><span style="color:#C792EA">()</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">db </span><span style="color:#C792EA">=</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">await</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">openDatabase</span><span style="color:#C792EA">();</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#FFA7C4">await</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">createStores</span><span style="color:#C792EA">();</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">private</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">async</span><span style="color:#CED2D6"> </span><span style="color:#8EACE3">createStores</span><span style="color:#C792EA">()</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#637777">// 创建三个存储空间</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#8EACE3">const</span><span style="color:#FFA7C4"> </span><span style="color:#CED2D6">stores</span><span style="color:#FFA7C4"> </span><span style="color:#C792EA">=</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">[</span></span>
<span data-line=""><span style="color:#CED2D6">      </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">        name</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">archive</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">,</span></span>
<span data-line=""><span style="color:#CED2D6">        config</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span><span style="color:#CED2D6"> keyPath</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">id</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">,</span><span style="color:#CED2D6"> autoIncrement</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#F87086">true</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">},</span></span>
<span data-line=""><span style="color:#CED2D6">      </span><span style="color:#C792EA">},</span></span>
<span data-line=""><span style="color:#CED2D6">      </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">        name</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">moment</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">,</span></span>
<span data-line=""><span style="color:#CED2D6">        config</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span><span style="color:#CED2D6"> keyPath</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">id</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">,</span><span style="color:#CED2D6"> autoIncrement</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#F87086">true</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">},</span></span>
<span data-line=""><span style="color:#CED2D6">      </span><span style="color:#C792EA">},</span></span>
<span data-line=""><span style="color:#CED2D6">      </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">        name</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">config</span><span style="color:#C792EA">&#x27;</span><span style="color:#C792EA">,</span></span>
<span data-line=""><span style="color:#CED2D6">        config</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span><span style="color:#CED2D6"> keyPath</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">&#x27;</span><span style="color:#ECC48D">key</span><span style="color:#C792EA">&#x27;</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">},</span></span>
<span data-line=""><span style="color:#CED2D6">      </span><span style="color:#C792EA">},</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#C792EA">];</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#FFA7C4">for</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">(</span><span style="color:#8EACE3">const</span><span style="color:#FFA7C4"> </span><span style="color:#CED2D6">store</span><span style="color:#FFA7C4"> </span><span style="color:#C792EA">of</span><span style="color:#CED2D6"> stores</span><span style="color:#C792EA">)</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">      </span><span style="color:#C792EA">if</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">(!</span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">db</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">objectStoreNames</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">contains</span><span style="color:#C792EA">(</span><span style="color:#CED2D6">store</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">name</span><span style="color:#C792EA">))</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">        </span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">db</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">createObjectStore</span><span style="color:#C792EA">(</span><span style="color:#CED2D6">store</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">name</span><span style="color:#C792EA">,</span><span style="color:#CED2D6"> store</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">config</span><span style="color:#C792EA">);</span></span>
<span data-line=""><span style="color:#CED2D6">      </span><span style="color:#C792EA">}</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#C792EA">}</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">}</span></span>
<span data-line=""><span style="color:#C792EA">}</span></span></code></pre></div>
<h3 id="5-"><a href="#5-" class="anchor">5. 上报策略</a></h3>
<p>我设计了多种上报策略来平衡实时性和性能：</p>
<div data-rehype-pretty-code-fragment=""><pre class="Overnight" style="background-color:var(--code-bg)" tabindex="0" data-language="ts" data-theme="default"><code data-language="ts" data-theme="default" style="display:grid"><span data-line=""><span style="color:#FFA7C4">class</span><span style="color:#CED2D6"> </span><span style="color:#FFCB8B">ReportStrategy</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">private</span><span style="color:#CED2D6"> batchSize </span><span style="color:#C792EA">=</span><span style="color:#CED2D6"> </span><span style="color:#F78C6C">100</span><span style="color:#C792EA">;</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">private</span><span style="color:#CED2D6"> batchTimeout </span><span style="color:#C792EA">=</span><span style="color:#CED2D6"> </span><span style="color:#F78C6C">5000</span><span style="color:#C792EA">;</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">private</span><span style="color:#CED2D6"> queue</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#FFCB8B">LogData</span><span style="color:#C792EA">[]</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">=</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">[];</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">private</span><span style="color:#CED2D6"> timer</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> NodeJS</span><span style="color:#C792EA">.</span><span style="color:#FFCB8B">Timeout</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">|</span><span style="color:#CED2D6"> </span><span style="color:#8EACE3">null</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">=</span><span style="color:#CED2D6"> </span><span style="color:#F87086">null</span><span style="color:#C792EA">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#8EACE3">constructor</span><span style="color:#C792EA">(</span><span style="color:#FFA7C4">private</span><span style="color:#CED2D6"> service</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#FFCB8B">LoggerService</span><span style="color:#C792EA">)</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">async</span><span style="color:#CED2D6"> </span><span style="color:#8EACE3">report</span><span style="color:#C792EA">(</span><span style="color:#CED2D6">data</span><span style="color:#C792EA">:</span><span style="color:#CED2D6"> </span><span style="color:#FFCB8B">LogData</span><span style="color:#C792EA">)</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#C792EA">if</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">(</span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">isUrgent</span><span style="color:#C792EA">(</span><span style="color:#CED2D6">data</span><span style="color:#C792EA">))</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">      </span><span style="color:#637777">// 立即上报</span></span>
<span data-line=""><span style="color:#CED2D6">      </span><span style="color:#FFA7C4">await</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">service</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">send</span><span style="color:#C792EA">(</span><span style="color:#CED2D6">data</span><span style="color:#C792EA">);</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#C792EA">}</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">else</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">      </span><span style="color:#637777">// 批量上报</span></span>
<span data-line=""><span style="color:#CED2D6">      </span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">queue</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">push</span><span style="color:#C792EA">(</span><span style="color:#CED2D6">data</span><span style="color:#C792EA">);</span></span>
<span data-line=""><span style="color:#CED2D6">      </span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">scheduleBatchReport</span><span style="color:#C792EA">();</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#C792EA">}</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#FFA7C4">private</span><span style="color:#CED2D6"> </span><span style="color:#8EACE3">scheduleBatchReport</span><span style="color:#C792EA">()</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#C792EA">if</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">(</span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">queue</span><span style="color:#C792EA">.</span><span style="color:#FFA7C4">length</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">&gt;=</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">batchSize</span><span style="color:#C792EA">)</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">      </span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">flushQueue</span><span style="color:#C792EA">();</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#C792EA">}</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">else</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">if</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">(!</span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">timer</span><span style="color:#C792EA">)</span><span style="color:#CED2D6"> </span><span style="color:#C792EA">{</span></span>
<span data-line=""><span style="color:#CED2D6">      </span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">timer </span><span style="color:#C792EA">=</span><span style="color:#CED2D6"> </span><span style="color:#8EACE3">setTimeout</span><span style="color:#C792EA">(()</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">=&gt;</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#8EACE3">flushQueue</span><span style="color:#C792EA">(),</span><span style="color:#CED2D6"> </span><span style="color:#FFA7C4">this</span><span style="color:#C792EA">.</span><span style="color:#CED2D6">batchTimeout</span><span style="color:#C792EA">);</span></span>
<span data-line=""><span style="color:#CED2D6">    </span><span style="color:#C792EA">}</span></span>
<span data-line=""><span style="color:#CED2D6">  </span><span style="color:#C792EA">}</span></span>
<span data-line=""><span style="color:#C792EA">}</span></span></code></pre></div>
<h2 id="-"><a href="#-" class="anchor">实践经验</a></h2>
<p>在实际应用中，我发现这个架构带来了很多好处：</p>
<ol>
<li>
<p><strong>灵活性</strong></p>
<ul>
<li>插件系统让功能扩展变得简单</li>
<li>服务层抽象使得存储和上报方式可以轻松替换</li>
<li>生命周期钩子提供了充分的定制空间</li>
</ul>
</li>
<li>
<p><strong>性能</strong></p>
<ul>
<li>WebWorker 处理避免阻塞主线程</li>
<li>批量上报减少网络请求</li>
<li>IndexedDB 提供高效的本地存储</li>
</ul>
</li>
<li>
<p><strong>可维护性</strong></p>
<ul>
<li>清晰的模块划分</li>
<li>标准化的插件接口</li>
<li>完善的类型定义</li>
</ul>
</li>
</ol>
<h2 id="-"><a href="#-" class="anchor">未来规划</a></h2>
<p>这个架构还在不断进化，我计划添加：</p>
<ol>
<li>更智能的采样策略</li>
<li>更强大的数据压缩算法</li>
<li>更完善的错误追踪能力</li>
<li>更多的内置插件</li>
</ol>
<h2 id="-"><a href="#-" class="anchor">总结</a></h2>
<p>设计一个好的监控 SDK 不仅需要考虑功能的完整性，更要思考如何让它既易用又高效。通过插件系统和生命周期管理，我实现了一个灵活可扩展的架构，它能够适应各种监控需求，同时保持了很好的性能和可维护性。</p>
<p>这个设计还在不断完善中，但核心的架构思想已经经受住了实践的检验。希望这些经验能对其他开发者有所帮助。</p><hr class="my-8"/><p class="flex gap-8"><a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="www.baidu.com">Discuss on</a><a target="_blank" class=" scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="www.baidu.com">Edit on GitHub</a></p></div></article><nav class="hidden lg:block lg:min-w-[240px] lg:max-w-[240px] xl:min-w-[280px] xl:max-w-[280px]"><div class="sticky top-8"><nav class="text-sm" aria-label="Table of contents"><p class="mb-4 text-base font-medium text-gray-900 dark:text-gray-100">目录</p><ul class="space-y-1"><li><a href="#-" class="block rounded-sm transition-all duration-200
                  pl-2">核心架构设计</a></li><li><a href="#1-thelogger-" class="block rounded-sm transition-all duration-200
                  pl-6">1. TheLogger 核心类</a></li><li><a href="#2-" class="block rounded-sm transition-all duration-200
                  pl-6">2. 插件系统</a></li><li><a href="#3-" class="block rounded-sm transition-all duration-200
                  pl-6">3. 服务层设计</a></li><li><a href="#4-" class="block rounded-sm transition-all duration-200
                  pl-6">4. 数据存储策略</a></li><li><a href="#5-" class="block rounded-sm transition-all duration-200
                  pl-6">5. 上报策略</a></li><li><a href="#-" class="block rounded-sm transition-all duration-200
                  pl-2">实践经验</a></li><li><a href="#-" class="block rounded-sm transition-all duration-200
                  pl-2">未来规划</a></li><li><a href="#-" class="block rounded-sm transition-all duration-200
                  pl-2">总结</a></li></ul></nav></div></nav></div></div><footer class="mt-12"><a class="__className_620977 inline-block text-2xl font-black hover:scale-[1.02] scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="/wooddashboard/"><span style="--myColor1:var(--pink);--myColor2:var(--purple);background-image:linear-gradient(45deg, var(--myColor1), var(--myColor2));background-clip:text;-webkit-background-clip:text;color:transparent;transition:--myColor1 0.2s ease-out, --myColor2 0.2s ease-in-out">wooddashboard</span></a></footer></main><script src="/wooddashboard/_next/static/chunks/webpack-488dd228726fd375.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/wooddashboard/_next/static/media/4f05ba3a6752a328-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/wooddashboard/_next/static/media/710e6adf42e8fe6f-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n3:HL[\"/wooddashboard/_next/static/media/7b379c56c483b024-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n4:HL[\"/wooddashboard/_next/static/media/7b9ca6a1d31c5662-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n5:HL[\"/wooddashboard/_next/static/media/931105f8d96e7f26-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n6:HL[\"/wooddashboard/_next/static/css/f4c9dd7a6d7a870e.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"7:I[4468,[],\"\"]\na:I[4641,[],\"\"]\nc:I[2063,[],\"\"]\nd:I[3436,[\"645\",\"static/chunks/645-cf0c536310c9bd45.js\",\"64\",\"static/chunks/app/%5Bslug%5D/layout-447ff52c5afa5bc6.js\"],\"default\"]\ne:I[1763,[\"645\",\"static/chunks/645-cf0c536310c9bd45.js\",\"792\",\"static/chunks/792-a990f77874873bec.js\",\"185\",\"static/chunks/app/layout-1a2c4bccb07c8fb1.js\"],\"default\"]\nf:I[966,[\"645\",\"static/chunks/645-cf0c536310c9bd45.js\",\"42\",\"static/chunks/app/%5Bslug%5D/page-0b8af52342fb8394.js\"],\"default\"]\n11:I[7115,[],\"\"]\nb:[\"slug\",\"monitoring-sdk-design\",\"d\"]\n12:[]\n"])</script><script>self.__next_f.push([1,"0:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/wooddashboard/_next/static/css/f4c9dd7a6d7a870e.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"$L7\",null,{\"buildId\":\"8T3wn1F1pRLVmuuuLhNTA\",\"assetPrefix\":\"/wooddashboard\",\"initialCanonicalUrl\":\"/monitoring-sdk-design/\",\"initialTree\":[\"\",{\"children\":[[\"slug\",\"monitoring-sdk-design\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"monitoring-sdk-design\\\"}\",{}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[[\"slug\",\"monitoring-sdk-design\",\"d\"],{\"children\":[\"__PAGE__\",{},[[\"$L8\",\"$L9\"],null],null]},[[[\"$\",\"$La\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"$b\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Lc\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}],[\"$\",\"footer\",null,{\"className\":\"mt-12\",\"children\":[\"$\",\"$Ld\",null,{}]}]],null],null]},[[\"$\",\"$Le\",null,{\"children\":[\"$\",\"$La\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Lc\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"article\",null,{\"className\":\"markdown\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"__className_620977 text-[40px] font-black leading-[44px] text-[--title]\",\"children\":\"Not found\"}],[\"$\",\"div\",null,{\"className\":\"markdown mt-10\",\"children\":[[\"$\",\"p\",null,{\"children\":\"这篇文章没有被找到 ?(没有创建 ?)\"}],[\"$\",\"p\",null,{\"children\":[\"如果你认为是网站的问题,可以点击这里告诉我\",\" \",[\"$\",\"$Lf\",null,{\"href\":\"https://github.com/Lxhouse/wooddashboard/issues\",\"children\":\"点击这里\"}]]}],[\"$\",\"p\",null,{\"children\":[\"如果是之前的文章,你却找不到了,可以来这里寻找试试\",\" \",[\"$\",\"$Lf\",null,{\"href\":\"https://github.com/Lxhouse/wooddashboard/tree/main/public\",\"children\":\"文章档案馆\"}]]}],[\"$\",\"p\",null,{\"children\":\"希望你可以找到你需要的那篇文章\"}]]}]]}],\"notFoundStyles\":[],\"styles\":null}],\"params\":{}}],null],null],\"couldBeIntercepted\":false,\"initialHead\":[false,\"$L10\"],\"globalErrorComponent\":\"$11\",\"missingSlots\":\"$W12\"}]]\n"])</script><script>self.__next_f.push([1,"9:[\"$\",\"div\",null,{\"className\":\"mx-auto max-w-[90rem] px-4 sm:px-6 lg:px-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"relative lg:flex lg:gap-8\",\"children\":[[\"$\",\"article\",null,{\"className\":\"prose prose-lg dark:prose-invert lg:min-w-[720px] lg:max-w-[720px] xl:min-w-[800px] xl:max-w-[800px]\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"__className_620977 text-[40px] font-black leading-[44px] text-[--title] mb-4\",\"children\":\"我是如何设计前端监控 SDK 的\"}],[\"$\",\"p\",null,{\"className\":\"text-sm text-gray-700 dark:text-gray-300 mb-8\",\"children\":\"2024/10/11\"}],[\"$\",\"div\",null,{\"className\":\"markdown\",\"children\":[\"$L13\",[\"$\",\"hr\",null,{\"className\":\"my-8\"}],[\"$\",\"p\",null,{\"className\":\"flex gap-8\",\"children\":[[\"$\",\"$Lf\",null,{\"href\":\"www.baidu.com\",\"children\":\"Discuss on\"}],[\"$\",\"$Lf\",null,{\"href\":\"www.baidu.com\",\"children\":\"Edit on GitHub\"}]]}]]}]]}],[\"$\",\"nav\",null,{\"className\":\"hidden lg:block lg:min-w-[240px] lg:max-w-[240px] xl:min-w-[280px] xl:max-w-[280px]\",\"children\":[\"$\",\"div\",null,{\"className\":\"sticky top-8\",\"children\":[\"$\",\"nav\",null,{\"className\":\"text-sm\",\"aria-label\":\"Table of contents\",\"children\":[[\"$\",\"p\",null,{\"className\":\"mb-4 text-base font-medium text-gray-900 dark:text-gray-100\",\"children\":\"目录\"}],[\"$\",\"ul\",null,{\"className\":\"space-y-1\",\"children\":[[\"$\",\"li\",\"-\",{\"children\":[\"$\",\"a\",null,{\"href\":\"#-\",\"className\":\"block rounded-sm transition-all duration-200\\n                  pl-2\",\"children\":\"核心架构设计\"}]}],[\"$\",\"li\",\"1-thelogger-\",{\"children\":[\"$\",\"a\",null,{\"href\":\"#1-thelogger-\",\"className\":\"block rounded-sm transition-all duration-200\\n                  pl-6\",\"children\":\"1. TheLogger 核心类\"}]}],[\"$\",\"li\",\"2-\",{\"children\":[\"$\",\"a\",null,{\"href\":\"#2-\",\"className\":\"block rounded-sm transition-all duration-200\\n                  pl-6\",\"children\":\"2. 插件系统\"}]}],[\"$\",\"li\",\"3-\",{\"children\":[\"$\",\"a\",null,{\"href\":\"#3-\",\"className\":\"block rounded-sm transition-all duration-200\\n                  pl-6\",\"children\":\"3. 服务层设计\"}]}],[\"$\",\"li\",\"4-\",{\"children\":[\"$\",\"a\",null,{\"href\":\"#4-\",\"className\":\"block rounded-sm transition-all duration-200\\n                  pl-6\",\"children\":\"4. 数据存储策略\"}]}],[\"$\",\"li\",\"5-\",{\"children\":[\"$\",\"a\",null,{\"href\":\"#5-\",\"className\":\"block rounded-sm transition-all duration-200\\n                  pl-6\",\"children\":\"5. 上报策略\"}]}],[\"$\",\"li\",\"-\",{\"children\":[\"$\",\"a\",null,{\"href\":\"#-\",\"className\":\"block rounded-sm transition-all duration-200\\n                  pl-2\",\"children\":\"实践经验\"}]}],[\"$\",\"li\",\"-\",{\"children\":[\"$\",\"a\",null,{\"href\":\"#-\",\"className\":\"block rounded-sm transition-all duration-200\\n                  pl-2\",\"children\":\"未来规划\"}]}],[\"$\",\"li\",\"-\",{\"children\":[\"$\",\"a\",null,{\"href\":\"#-\",\"className\":\"block rounded-sm transition-all duration-200\\n                  pl-2\",\"children\":\"总结\"}]}]]}]]}]}]}]]}]}]\n"])</script><script>self.__next_f.push([1,"10:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"我是如何设计前端监控 SDK 的 — wooddashboard\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"分享我在设计前端监控 SDK 时的架构思考，包括插件系统、生命周期管理、数据存储等核心设计\"}],[\"$\",\"link\",\"4\",{\"rel\":\"icon\",\"href\":\"/wooddashboard/icon.png?7c5860f098ab6c65\",\"type\":\"image/png\",\"sizes\":\"400x400\"}],[\"$\",\"meta\",\"5\",{\"name\":\"next-size-adjust\"}]]\n8:null\n"])</script><script>self.__next_f.push([1,"13:[[\"$\",\"h1\",null,{\"id\":\"-sdk-\",\"children\":[\"$\",\"a\",null,{\"href\":\"#-sdk-\",\"className\":\"anchor\",\"children\":\"我是如何设计前端监控 SDK 的\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"作为一名前端监控领域的开发者，我一直在思考如何设计一个既灵活又高效的监控 SDK。经过多次迭代和实践，我最终确定了一个以插件系统和生命周期为核心的架构设计。让我来分享一下这个设计的核心思路。\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"-\",\"children\":[\"$\",\"a\",null,{\"href\":\"#-\",\"className\":\"anchor\",\"children\":\"核心架构设计\"}]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"1-thelogger-\",\"children\":[\"$\",\"a\",null,{\"href\":\"#1-thelogger-\",\"className\":\"anchor\",\"children\":\"1. TheLogger 核心类\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"在设计之初，我就决定要有一个强大的核心类作为整个 SDK 的基础。我将其命名为 TheLogger，它负责协调整个监控系统的运行。\"}],\"\\n\",[\"$\",\"div\",null,{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[\"$\",\"pre\",null,{\"className\":\"Overnight\",\"style\":{\"backgroundColor\":\"var(--code-bg)\"},\"tabIndex\":\"0\",\"data-language\":\"ts\",\"data-theme\":\"default\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"ts\",\"data-theme\":\"default\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFCB8B\"},\"children\":\"TheLogger\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" plugins\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFCB8B\"},\"children\":\"Plugin\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"[]\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"[];\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" lifecycle\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFCB8B\"},\"children\":\"Lifecycle\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" store\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFCB8B\"},\"children\":\"Store\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"constructor\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"config\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFCB8B\"},\"children\":\"LoggerConfig\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\")\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"lifecycle \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"Lifecycle\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"();\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"store \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"Store\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"config\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"storage\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#637777\"},\"children\":\"// 生命周期方法\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"async\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"init\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"()\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"await\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"lifecycle\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"emit\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"init\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"await\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"initPlugins\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"();\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"async\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"start\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"()\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"await\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"lifecycle\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"emit\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"start\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"await\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"startPlugins\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"();\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"async\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"stop\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"()\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"await\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"lifecycle\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"emit\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"stop\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"await\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"stopPlugins\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"();\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"async\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"destroy\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"()\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"await\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"lifecycle\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"emit\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"destroy\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"await\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"destroyPlugins\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"();\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"2-\",\"children\":[\"$\",\"a\",null,{\"href\":\"#2-\",\"className\":\"anchor\",\"children\":\"2. 插件系统\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"插件系统是我最自豪的设计之一。它让 SDK 具备了无限的扩展可能：\"}],\"\\n\",[\"$\",\"div\",null,{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[\"$\",\"pre\",null,{\"className\":\"Overnight\",\"style\":{\"backgroundColor\":\"var(--code-bg)\"},\"tabIndex\":\"0\",\"data-language\":\"ts\",\"data-theme\":\"default\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"ts\",\"data-theme\":\"default\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"interface\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" Plugin \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"apply\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"logger\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFCB8B\"},\"children\":\"TheLogger\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"):\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"init\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"?():\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFCB8B\"},\"children\":\"Promise\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"start\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"?():\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFCB8B\"},\"children\":\"Promise\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"stop\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"?():\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFCB8B\"},\"children\":\"Promise\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"destroy\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"?():\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFCB8B\"},\"children\":\"Promise\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFCB8B\"},\"children\":\"ClickTrackingPlugin\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"implements\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" Plugin \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  name \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"click-tracking\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"handler\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFCB8B\"},\"children\":\"MouseEvent\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\")\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"apply\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"logger\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFCB8B\"},\"children\":\"TheLogger\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\")\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"handler\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\")\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      logger\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"track\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"click\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"        x\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"clientX\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"        y\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"clientY\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"        target\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"target\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"});\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"};\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"start\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"()\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    document\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"addEventListener\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"click\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"handler\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"stop\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"()\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    document\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"removeEventListener\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"click\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"handler\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"3-\",\"children\":[\"$\",\"a\",null,{\"href\":\"#3-\",\"className\":\"anchor\",\"children\":\"3. 服务层设计\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"我特意将服务层设计成可扩展的形式：\"}],\"\\n\",[\"$\",\"div\",null,{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[\"$\",\"pre\",null,{\"className\":\"Overnight\",\"style\":{\"backgroundColor\":\"var(--code-bg)\"},\"tabIndex\":\"0\",\"data-language\":\"ts\",\"data-theme\":\"default\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"ts\",\"data-theme\":\"default\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"interface\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" LoggerService \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"serve\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"():\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFCB8B\"},\"children\":\"Promise\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"send\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"data\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFCB8B\"},\"children\":\"LogData\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"):\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFCB8B\"},\"children\":\"Promise\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFCB8B\"},\"children\":\"DefaultService\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"implements\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" LoggerService \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" worker\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFCB8B\"},\"children\":\"Worker\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"constructor\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"()\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"worker \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"Worker\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"logger-worker.js\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"async\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"serve\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"()\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#637777\"},\"children\":\"// 初始化服务\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"await\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"initWorker\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"();\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"await\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"initStorage\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"();\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"async\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"send\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"data\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFCB8B\"},\"children\":\"LogData\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\")\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#637777\"},\"children\":\"// 通过 Worker 异步处理数据\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"worker\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"postMessage\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"({\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      type\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"process\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      data\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"});\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"4-\",\"children\":[\"$\",\"a\",null,{\"href\":\"#4-\",\"className\":\"anchor\",\"children\":\"4. 数据存储策略\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"在存储方面，我选择了 IndexedDB 作为主要存储方案：\"}],\"\\n\",[\"$\",\"div\",null,{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[\"$\",\"pre\",null,{\"className\":\"Overnight\",\"style\":{\"backgroundColor\":\"var(--code-bg)\"},\"tabIndex\":\"0\",\"data-language\":\"ts\",\"data-theme\":\"default\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"ts\",\"data-theme\":\"default\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFCB8B\"},\"children\":\"Store\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" db\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFCB8B\"},\"children\":\"IDBDatabase\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"async\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"init\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"()\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"db \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"await\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"openDatabase\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"();\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"await\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"createStores\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"();\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"async\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"createStores\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"()\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#637777\"},\"children\":\"// 创建三个存储空间\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"const\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"stores\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"[\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"        name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"archive\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"        config\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" keyPath\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"id\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" autoIncrement\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F87086\"},\"children\":\"true\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"},\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"},\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"        name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"moment\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"        config\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" keyPath\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"id\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" autoIncrement\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F87086\"},\"children\":\"true\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"},\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"},\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"        name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"config\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"        config\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" keyPath\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ECC48D\"},\"children\":\"key\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"},\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"},\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"];\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"for\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"const\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"store\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"of\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" stores\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\")\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(!\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"db\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"objectStoreNames\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"contains\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"store\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"))\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"        \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"db\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"createObjectStore\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"store\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" store\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"config\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"5-\",\"children\":[\"$\",\"a\",null,{\"href\":\"#5-\",\"className\":\"anchor\",\"children\":\"5. 上报策略\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"我设计了多种上报策略来平衡实时性和性能：\"}],\"\\n\",[\"$\",\"div\",null,{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[\"$\",\"pre\",null,{\"className\":\"Overnight\",\"style\":{\"backgroundColor\":\"var(--code-bg)\"},\"tabIndex\":\"0\",\"data-language\":\"ts\",\"data-theme\":\"default\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"ts\",\"data-theme\":\"default\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFCB8B\"},\"children\":\"ReportStrategy\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" batchSize \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F78C6C\"},\"children\":\"100\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" batchTimeout \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F78C6C\"},\"children\":\"5000\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" queue\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFCB8B\"},\"children\":\"LogData\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"[]\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"[];\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" timer\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" NodeJS\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFCB8B\"},\"children\":\"Timeout\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"|\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F87086\"},\"children\":\"null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"constructor\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" service\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFCB8B\"},\"children\":\"LoggerService\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\")\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{}\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"async\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"report\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"data\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFCB8B\"},\"children\":\"LogData\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\")\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"isUrgent\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"data\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"))\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#637777\"},\"children\":\"// 立即上报\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"await\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"service\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"send\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"data\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"else\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#637777\"},\"children\":\"// 批量上报\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"queue\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"push\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"data\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"scheduleBatchReport\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"();\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"scheduleBatchReport\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"()\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"queue\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"length\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"\u003e=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"batchSize\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\")\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"flushQueue\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"();\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"else\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(!\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"timer\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\")\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"timer \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"setTimeout\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(()\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8EACE3\"},\"children\":\"flushQueue\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"(),\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#FFA7C4\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"batchTimeout\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CED2D6\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#C792EA\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"-\",\"children\":[\"$\",\"a\",null,{\"href\":\"#-\",\"className\":\"anchor\",\"children\":\"实践经验\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"在实际应用中，我发现这个架构带来了很多好处：\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"灵活性\"}]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"插件系统让功能扩展变得简单\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"服务层抽象使得存储和上报方式可以轻松替换\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"生命周期钩子提供了充分的定制空间\"}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"性能\"}]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"WebWorker 处理避免阻塞主线程\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"批量上报减少网络请求\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"IndexedDB 提供高效的本地存储\"}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"可维护性\"}]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"清晰的模块划分\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"标准化的插件接口\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"完善的类型定义\"}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"-\",\"children\":[\"$\",\"a\",null,{\"href\":\"#-\",\"className\":\"anchor\",\"children\":\"未来规划\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"这个架构还在不断进化，我计划添加：\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"更智能的采样策略\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"更强大的数据压缩算法\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"更完善的错误追踪能力\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"更多的内置插件\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"-\",\"children\":[\"$\",\"a\",null,{\"href\":\"#-\",\"className\":\"anchor\",\"children\":\"总结\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"设计一个好的监控 SDK 不仅需要考虑功能的完整性，更要思考如何让它既易用又高效。通过插件系统和生命周期管理，我实现了一个灵活可扩展的架构，它能够适应各种监控需求，同时保持了很好的性能和可维护性。\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"这个设计还在不断完善中，但核心的架构思想已经经受住了实践的检验。希望这些经验能对其他开发者有所帮助。\"}]]\n"])</script></body></html>